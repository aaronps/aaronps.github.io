
<!DOCTYPE HTML>
<html lang="" >
    <head>
        <meta charset="UTF-8">
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <title>kafka Â· GitBook</title>
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="description" content="">
        <meta name="generator" content="GitBook 3.2.3">
        
        
        
    
    <link rel="stylesheet" href="../gitbook/style.css">

    
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-asciidoc-admonition-icons/plugin.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-highlight/website.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-search/search.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-fontsettings/website.css">
                
            
        

    

    
        
    
        
    
        
    
        
    
        
    
        
    

        
    
    
    <meta name="HandheldFriendly" content="true"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <link rel="apple-touch-icon-precomposed" sizes="152x152" href="../gitbook/images/apple-touch-icon-precomposed-152.png">
    <link rel="shortcut icon" href="../gitbook/images/favicon.ico" type="image/x-icon">

    
    <link rel="next" href="zookeeper.html" />
    
    
    <link rel="prev" href="cloud.html" />
    

    </head>
    <body>
        
<div class="book">
    <div class="book-summary">
        
            
<div id="book-search-input" role="search">
    <input type="text" placeholder="Type to search" />
</div>

            
                <nav role="navigation">
                


<ul class="summary">
    
    

    

    
        
        
    
        <li class="chapter " data-level="1.1" data-path="../">
            
                <a href="../">
            
                    
                    Introduction
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2" >
            
                <span>
            
                    
                    Languages
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.2.1" data-path="../languages/c++.html">
            
                <a href="../languages/c++.html">
            
                    
                    c++
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.2" data-path="../languages/erlang.html">
            
                <a href="../languages/erlang.html">
            
                    
                    Erlang
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.2.2.1" data-path="../languages/erlang/rebar3.html">
            
                <a href="../languages/erlang/rebar3.html">
            
                    
                    Rebar3
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.2.3" data-path="../languages/java.html">
            
                <a href="../languages/java.html">
            
                    
                    Java
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.4" data-path="../languages/javascript.html">
            
                <a href="../languages/javascript.html">
            
                    
                    Javascript
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.5" data-path="../languages/haxe.html">
            
                <a href="../languages/haxe.html">
            
                    
                    Haxe
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.3" >
            
                <span>
            
                    
                    Tools
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.3.1" data-path="../tools/git.html">
            
                <a href="../tools/git.html">
            
                    
                    git
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.2" data-path="../tools/npm.html">
            
                <a href="../tools/npm.html">
            
                    
                    npm
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.3" data-path="../tools/gradle.html">
            
                <a href="../tools/gradle.html">
            
                    
                    gradle
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.4" data-path="../tools/intellij.html">
            
                <a href="../tools/intellij.html">
            
                    
                    intellij
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.5" data-path="../tools/eclipse.html">
            
                <a href="../tools/eclipse.html">
            
                    
                    eclipse
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.6" data-path="../tools/vscode.html">
            
                <a href="../tools/vscode.html">
            
                    
                    vscode
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.7" data-path="../tools/cmake.html">
            
                <a href="../tools/cmake.html">
            
                    
                    cmake
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.8" data-path="../tools/mingw-w64.html">
            
                <a href="../tools/mingw-w64.html">
            
                    
                    mingw-w64
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.9" data-path="../tools/browsers.html">
            
                <a href="../tools/browsers.html">
            
                    
                    browsers
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.4" data-path="../video/video.html">
            
                <a href="../video/video.html">
            
                    
                    Video
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.4.1" data-path="../video/ffmpeg.html">
            
                <a href="../video/ffmpeg.html">
            
                    
                    ffmpeg
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.2" data-path="../video/panorama.html">
            
                <a href="../video/panorama.html">
            
                    
                    Panorama
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.3" data-path="../video/sdl2.html">
            
                <a href="../video/sdl2.html">
            
                    
                    SDL2
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.5" data-path="../web/web.html">
            
                <a href="../web/web.html">
            
                    
                    Web
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.5.1" data-path="../web/vuejs.html">
            
                <a href="../web/vuejs.html">
            
                    
                    vuejs
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.2" data-path="../web/webpack.html">
            
                <a href="../web/webpack.html">
            
                    
                    webpack
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.6" >
            
                <span>
            
                    
                    Net
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.6.1" data-path="../net/ssl_certificates.html">
            
                <a href="../net/ssl_certificates.html">
            
                    
                    SSL
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.7" data-path="cloud.html">
            
                <a href="cloud.html">
            
                    
                    Cloud and distributed
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter active" data-level="1.7.1" data-path="kafka.html">
            
                <a href="kafka.html">
            
                    
                    kafka
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.2" data-path="zookeeper.html">
            
                <a href="zookeeper.html">
            
                    
                    zookeeper
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.8" >
            
                <span>
            
                    
                    Operating Systems
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.8.1" data-path="../operatingsystems/linux.html">
            
                <a href="../operatingsystems/linux.html">
            
                    
                    Linux
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8.2" data-path="../operatingsystems/windows.html">
            
                <a href="../operatingsystems/windows.html">
            
                    
                    Windows
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

    

    <li class="divider"></li>

    <li>
        <a href="https://www.gitbook.com" target="blank" class="gitbook-link">
            Published with GitBook
        </a>
    </li>
</ul>


                </nav>
            
        
    </div>

    <div class="book-body">
        
            <div class="body-inner">
                
                    

<div class="book-header" role="navigation">
    

    <!-- Title -->
    <h1>
        <i class="fa fa-circle-o-notch fa-spin"></i>
        <a href=".." >kafka</a>
    </h1>
</div>




                    <div class="page-wrapper" tabindex="-1" role="main">
                        <div class="page-inner">
                            
<div id="book-search-results">
    <div class="search-noresults">
    
                                <section class="normal markdown-section">
                                
                                <h1 id="kafka">kafka</h1>
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p><a href="https://kafka.apache.org/" class="bare" target="_blank">https://kafka.apache.org/</a></p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_setup">Setup</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Download the tgz, uncompress</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>start zookeper:</p>
<div class="ulist">
<ul>
<li>
<p>config is in <code>config/zookeper.properties</code></p>
<div class="ulist">
<ul>
<li>
<p>may need to change dataDir for windows</p>
</li>
<li>
<p>port is defined here too</p>
</li>
</ul>
</div>
</li>
<li>
<p><code>bin/zookeper-server-start.sh config/zookeper.properties</code></p>
</li>
<li>
<p>note: stopping zookeper also stops all the clients connected to it (at
least the kafka console-consumer/producer I was running)</p>
</li>
<li>
<p>note: zookeeper-shell to do some operations on the server</p>
</li>
</ul>
</div>
</li>
<li>
<p>start kafka:</p>
<div class="ulist">
<ul>
<li>
<p>config is in config/server.properties:</p>
<div class="ulist">
<ul>
<li>
<p>may need to set broker.id for each broker</p>
</li>
<li>
<p>may need to change log.dirs for windows</p>
</li>
<li>
<p>zookeper.connect to set the port configured on zookeper</p>
</li>
<li>
<p>If want to change the port (default is 9092) change &quot;listeners&quot;</p>
</li>
<li>
<p>If want to be able to delete topics set: delete.topic.enable=true</p>
</li>
<li>
<p>listeners example for ip address: <code>PLAINTEXT://ipaddress:9092</code></p>
</li>
</ul>
</div>
</li>
<li>
<p><code>bin/kafka-server-start.sh config/server.properties</code></p>
</li>
</ul>
</div>
</li>
</ol>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<div class="fa icon-important" title="Important">&#xF06A;</div>
</td>
<td class="content">
If you don&#x2019;t change <strong>listeners</strong>, kafka will use your hostname by
default, and this is what will be registered on zookeeper, and because of this
the clients will need some way to resolve the name, usually the <code>hosts</code> file.
</td>
</tr>
</table>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Zookeeper default ports</dt>
<dd>
<p>Open on firewall: 2181, 2888, 3888</p>
</dd>
<dt class="hdlist1">Kaka default port</dt>
<dd>
<p>9092</p>
</dd>
</dl>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_commands">Commands</h2>
<div class="sectionbody">
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="fa icon-note" title="Note">&#xF05A;</div>
</td>
<td class="content">
In Linux use <code>bin/script-name.sh</code> in Windows <code>bin\windows\script-name</code>
</td>
</tr>
</table>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Topics</dt>
<dd>
<p><em>--zookeeper is always needed</em></p>
<div class="literalblock">
<div class="content">
<pre>bin/kafka-topics.sh --zookeeper localhost:2181 &lt;command&gt;</pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">commands</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>--list</p>
</li>
<li>
<p>--create --topic &lt;topic_name&gt; --replication-factor 1 --partitions 1</p>
</li>
<li>
<p>--delete --topic &lt;topic_name&gt; <em>(note it requires config change to work)</em></p>
</li>
<li>
<p>--describe --topic &lt;topic_name&gt;</p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
</dd>
<dt class="hdlist1">Send messages from console</dt>
<dd>
<p><em>this will read from stdin and publish on topic</em></p>
<div class="literalblock">
<div class="content">
<pre>bin/kafka-console-producer.sh --broker-list localhost:9092 --topic &lt;name&gt;</pre>
</div>
</div>
</dd>
<dt class="hdlist1">Receive messages on console</dt>
<dd>
<p><code>bin/kafka-console-consumer.sh --bootstrap-server localhost:9092 --topic &lt;name&gt;</code></p>
<div class="dlist">
<dl>
<dt class="hdlist1">other parameters</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>--from-beginning if want to receive starting from the earliest present in the log</p>
</li>
<li>
<p>--property print.key=true if want to see the keys</p>
</li>
<li>
<p>--property key.separator=&quot;&lt;separator&gt;&quot; to set the separator, default \t</p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
</dd>
</dl>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<div class="fa icon-warning" title="Warning">&#xF071;</div>
</td>
<td class="content">
Receiving messages encoded in UTF-8 might show incorrect values (at least on Windows)
</td>
</tr>
</table>
</div>
<div class="sect2">
<h3 id="_recover_after_kafka_server_stop_on_windows">Recover after kafka-server-stop on Windows</h3>
<div class="paragraph">
<p>After stopping with this command, when trying to start again it complains some file.timeindex (from a topic) is used by another program:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>stopping zookeeper and starting again doesn&#x2019;t help</p>
</li>
<li>
<p>seems related to <a href="https://issues.apache.org/jira/browse/KAFKA-6044" class="bare" target="_blank">https://issues.apache.org/jira/browse/KAFKA-6044</a></p>
</li>
<li>
<p>To fix just delete the kafka-logs data folder&#x2026;</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_start_multiple_nodes_in_a_cluster">Start multiple nodes in a cluster</h3>
<div class="paragraph">
<p>Use different configuration files (config/server.properties) with different id and different listener port:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	broker.id = 1
	listeners=PLAINTEXT://:9093
	log.dir=/another/dir/for/this/one</pre>
</div>
</div>
<div class="paragraph">
<p>Now when creating a topic we could add a replication factor bigger than one</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_usage_notes">Usage notes</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Consumer should poll() at least once every session.timeout.ms or it will get CommitFailedException, this is also usefull if the binary fails to work or hangs somewhere.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_systemd_example_service_files">systemd example service files</h2>
<div class="sectionbody">
<div class="listingblock">
<div class="title">kafka.service</div>
<div class="content">
<pre class="highlight"><code class="language-ini" data-lang="ini"><span class="hljs-section">[Unit]</span>
<span class="hljs-attr">Description</span>=Kafka service
<span class="hljs-attr">After</span>=network.target
<span class="hljs-attr">Wants</span>=kafka-zookeeper.service
<span class="hljs-section">
[Service]</span>
<span class="hljs-attr">ExecStart</span>=/path/to/kafka/bin/kafka-server-start.sh /path/to/kafka/config/server.properties
<span class="hljs-attr">SuccessExitStatus</span>=<span class="hljs-number">143</span>
<span class="hljs-attr">StandardOutput</span>=null
<span class="hljs-section">
[Install]</span>
<span class="hljs-attr">WantedBy</span>=multi-user.target</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">kafka-zookeeper.service</div>
<div class="content">
<pre class="highlight"><code class="language-ini" data-lang="ini"><span class="hljs-section">[Unit]</span>
<span class="hljs-attr">Description</span>=Kafka Zookeeper service
<span class="hljs-attr">After</span>=network.target
<span class="hljs-section">
[Service]</span>
<span class="hljs-attr">ExecStart</span>=/path/to/kafka/bin/zookeeper-server-start.sh /path/to/kafka/config/zookeeper.properties
<span class="hljs-attr">SuccessExitStatus</span>=<span class="hljs-number">143</span>
<span class="hljs-attr">StandardOutput</span>=null
<span class="hljs-section">
[Install]</span>
<span class="hljs-attr">WantedBy</span>=multi-user.target</code></pre>
</div>
</div>
</div>
</div>
                                
                                </section>
                            
    </div>
    <div class="search-results">
        <div class="has-results">
            
            <h1 class="search-results-title"><span class='search-results-count'></span> results matching "<span class='search-query'></span>"</h1>
            <ul class="search-results-list"></ul>
            
        </div>
        <div class="no-results">
            
            <h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1>
            
        </div>
    </div>
</div>

                        </div>
                    </div>
                
            </div>

            
                
                <a href="cloud.html" class="navigation navigation-prev " aria-label="Previous page: Cloud and distributed">
                    <i class="fa fa-angle-left"></i>
                </a>
                
                
                <a href="zookeeper.html" class="navigation navigation-next " aria-label="Next page: zookeeper">
                    <i class="fa fa-angle-right"></i>
                </a>
                
            
        
    </div>

    <script>
        var gitbook = gitbook || [];
        gitbook.push(function() {
            gitbook.page.hasChanged({"page":{"title":"kafka","level":"1.7.1","depth":2,"next":{"title":"zookeeper","level":"1.7.2","depth":2,"path":"cloud/zookeeper.md","ref":"cloud/zookeeper.md","articles":[]},"previous":{"title":"Cloud and distributed","level":"1.7","depth":1,"path":"cloud/cloud.md","ref":"cloud/cloud.md","articles":[{"title":"kafka","level":"1.7.1","depth":2,"path":"cloud/kafka.adoc","ref":"cloud/kafka.adoc","articles":[]},{"title":"zookeeper","level":"1.7.2","depth":2,"path":"cloud/zookeeper.md","ref":"cloud/zookeeper.md","articles":[]}]},"dir":"ltr"},"config":{"gitbook":"*","theme":"default","variables":{},"plugins":["asciidoc-admonition-icons"],"pluginsConfig":{"asciidoc-admonition-icons":{},"highlight":{},"search":{},"lunr":{"maxIndexSize":1000000,"ignoreSpecialCharacters":false},"sharing":{"facebook":true,"twitter":true,"google":false,"weibo":false,"instapaper":false,"vk":false,"all":["facebook","google","twitter","weibo","instapaper"]},"fontsettings":{"theme":"white","family":"sans","size":2},"theme-default":{"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"showLevel":false}},"structure":{"langs":"LANGS.md","readme":"README.md","glossary":"GLOSSARY.md","summary":"SUMMARY.md"},"pdf":{"pageNumbers":true,"fontSize":12,"fontFamily":"Arial","paperSize":"a4","chapterMark":"pagebreak","pageBreaksBefore":"/","margin":{"right":62,"left":62,"top":56,"bottom":56}},"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"}},"file":{"path":"cloud/kafka.adoc","mtime":"2018-01-29T14:21:08.175Z","type":"asciidoc"},"gitbook":{"version":"3.2.3","time":"2018-01-29T14:22:32.784Z"},"basePath":"..","book":{"language":""}});
        });
    </script>
</div>

        
    <script src="../gitbook/gitbook.js"></script>
    <script src="../gitbook/theme.js"></script>
    
        
        <script src="../gitbook/gitbook-plugin-search/search-engine.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-search/search.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-lunr/lunr.min.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-lunr/search-lunr.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-sharing/buttons.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-fontsettings/fontsettings.js"></script>
        
    

    </body>
</html>

