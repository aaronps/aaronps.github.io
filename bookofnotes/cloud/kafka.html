
<!DOCTYPE HTML>
<html lang="" >
    <head>
        <meta charset="UTF-8">
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <title>kafka Â· GitBook</title>
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="description" content="">
        <meta name="generator" content="GitBook 3.2.3">
        
        
        
    
    <link rel="stylesheet" href="../gitbook/style.css">

    
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-asciidoc-admonition-icons/plugin.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-highlight/website.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-search/search.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-fontsettings/website.css">
                
            
        

    

    
        
    
        
    
        
    
        
    
        
    
        
    

        
    
    
    <meta name="HandheldFriendly" content="true"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <link rel="apple-touch-icon-precomposed" sizes="152x152" href="../gitbook/images/apple-touch-icon-precomposed-152.png">
    <link rel="shortcut icon" href="../gitbook/images/favicon.ico" type="image/x-icon">

    
    <link rel="next" href="zookeeper.html" />
    
    
    <link rel="prev" href="cloud.html" />
    

    </head>
    <body>
        
<div class="book">
    <div class="book-summary">
        
            
<div id="book-search-input" role="search">
    <input type="text" placeholder="Type to search" />
</div>

            
                <nav role="navigation">
                


<ul class="summary">
    
    

    

    
        
        
    
        <li class="chapter " data-level="1.1" data-path="../">
            
                <a href="../">
            
                    
                    Introduction
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2" >
            
                <span>
            
                    
                    Languages
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.2.1" data-path="../languages/c++.html">
            
                <a href="../languages/c++.html">
            
                    
                    c++
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.2" data-path="../languages/erlang.html">
            
                <a href="../languages/erlang.html">
            
                    
                    Erlang
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.2.2.1" data-path="../languages/erlang/rebar3.html">
            
                <a href="../languages/erlang/rebar3.html">
            
                    
                    Rebar3
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.2.3" data-path="../languages/java.html">
            
                <a href="../languages/java.html">
            
                    
                    Java
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.4" data-path="../languages/javascript.html">
            
                <a href="../languages/javascript.html">
            
                    
                    Javascript
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.5" data-path="../languages/haxe.html">
            
                <a href="../languages/haxe.html">
            
                    
                    Haxe
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.3" >
            
                <span>
            
                    
                    Tools
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.3.1" data-path="../tools/git.html">
            
                <a href="../tools/git.html">
            
                    
                    git
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.2" data-path="../tools/npm.html">
            
                <a href="../tools/npm.html">
            
                    
                    npm
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.3" data-path="../tools/gradle.html">
            
                <a href="../tools/gradle.html">
            
                    
                    gradle
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.4" data-path="../tools/intellij.html">
            
                <a href="../tools/intellij.html">
            
                    
                    intellij
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.5" data-path="../tools/eclipse.html">
            
                <a href="../tools/eclipse.html">
            
                    
                    eclipse
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.6" data-path="../tools/vscode.html">
            
                <a href="../tools/vscode.html">
            
                    
                    vscode
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.7" data-path="../tools/cmake.html">
            
                <a href="../tools/cmake.html">
            
                    
                    cmake
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.8" data-path="../tools/mingw-w64.html">
            
                <a href="../tools/mingw-w64.html">
            
                    
                    mingw-w64
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.9" data-path="../tools/browsers.html">
            
                <a href="../tools/browsers.html">
            
                    
                    browsers
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.4" data-path="../video/video.html">
            
                <a href="../video/video.html">
            
                    
                    Video
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.4.1" data-path="../video/ffmpeg.html">
            
                <a href="../video/ffmpeg.html">
            
                    
                    ffmpeg
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.2" data-path="../video/panorama.html">
            
                <a href="../video/panorama.html">
            
                    
                    Panorama
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.3" data-path="../video/sdl2.html">
            
                <a href="../video/sdl2.html">
            
                    
                    SDL2
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.5" data-path="../web/web.html">
            
                <a href="../web/web.html">
            
                    
                    Web
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.5.1" data-path="../web/vuejs.html">
            
                <a href="../web/vuejs.html">
            
                    
                    vuejs
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.2" data-path="../web/webpack.html">
            
                <a href="../web/webpack.html">
            
                    
                    webpack
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.6" >
            
                <span>
            
                    
                    Net
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.6.1" data-path="../net/ssl_certificates.html">
            
                <a href="../net/ssl_certificates.html">
            
                    
                    SSL
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.7" data-path="cloud.html">
            
                <a href="cloud.html">
            
                    
                    Cloud and distributed
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter active" data-level="1.7.1" data-path="kafka.html">
            
                <a href="kafka.html">
            
                    
                    kafka
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.2" data-path="zookeeper.html">
            
                <a href="zookeeper.html">
            
                    
                    zookeeper
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.8" >
            
                <span>
            
                    
                    Operating Systems
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.8.1" data-path="../operatingsystems/linux.html">
            
                <a href="../operatingsystems/linux.html">
            
                    
                    Linux
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8.2" data-path="../operatingsystems/windows.html">
            
                <a href="../operatingsystems/windows.html">
            
                    
                    Windows
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

    

    <li class="divider"></li>

    <li>
        <a href="https://www.gitbook.com" target="blank" class="gitbook-link">
            Published with GitBook
        </a>
    </li>
</ul>


                </nav>
            
        
    </div>

    <div class="book-body">
        
            <div class="body-inner">
                
                    

<div class="book-header" role="navigation">
    

    <!-- Title -->
    <h1>
        <i class="fa fa-circle-o-notch fa-spin"></i>
        <a href=".." >kafka</a>
    </h1>
</div>




                    <div class="page-wrapper" tabindex="-1" role="main">
                        <div class="page-inner">
                            
<div id="book-search-results">
    <div class="search-noresults">
    
                                <section class="normal markdown-section">
                                
                                <h1 id="kafka">kafka</h1>
<p><a href="https://kafka.apache.org/" target="_blank">https://kafka.apache.org/</a></p>
<h2 id="setup">Setup</h2>
<p>Download the tgz, uncompress</p>
<ol>
<li><p>start zookeper:</p>
<ul>
<li>config is in <code>config/zookeper.properties</code><ul>
<li>may need to change dataDir for windows</li>
<li>port is defined here too</li>
</ul>
</li>
<li><code>bin/zookeper-server-start.sh config/zookeper.properties</code></li>
<li>note: stopping zookeper also stops all the clients connected to it (at
least the kafka console-consumer/producer I was running)</li>
<li>note: zookeeper-shell to do some operations on the server</li>
</ul>
</li>
<li><p>start kafka:</p>
<ul>
<li>config is in config/server.properties:<ul>
<li>may need to set broker.id for each broker</li>
<li>may need to change log.dirs for windows</li>
<li>zookeper.connect to set the port configured on zookeper</li>
<li>If want to change the port (default is 9092) change &quot;listeners&quot;</li>
<li>If want to be able to delete topics set: delete.topic.enable=true</li>
<li>listeners example for ip address: <code>PLAINTEXT://ipaddress:9092</code></li>
</ul>
</li>
<li><code>bin/kafka-server-start.sh config/server.properties</code></li>
</ul>
</li>
</ol>
<p>IMPORTANT: If you don&apos;t change <strong>listeners</strong>, kafka will use your hostname by
default, and this is what will be registered on zookeeper, and because of this
the clients will need some way to resolve the name, usually the <code>hosts</code> file.</p>
<p>Zookeeper default ports:: Open on firewall: 2181, 2888, 3888
Kaka default port:: 9092</p>
<h2 id="commands">Commands</h2>
<p>NOTE: In Linux use <code>bin/script-name.sh</code> in Windows <code>bin\windows\script-name</code></p>
<p>Topics: <em>--zookeeper is always needed</em></p>
<pre><code>bin/kafka-topics.sh --zookeeper localhost:2181 &lt;command&gt;

commands:::

    * --list
    * --create --topic &lt;topic_name&gt; --replication-factor 1 --partitions 1
    * --delete --topic &lt;topic_name&gt; _(note it requires config change to work)_
    * --describe --topic &lt;topic_name&gt;

# increase partitions count for a topic (cannot decrease)
bin/kafka-topics.sh ... --alter --topic _name_ --partitions N
</code></pre><p>Send messages from console:: <em>this will read from stdin and publish on topic</em></p>
<pre><code>bin/kafka-console-producer.sh --broker-list localhost:9092 --topic &lt;name&gt;
</code></pre><p>Receive messages on console::</p>
<pre><code># localhost:9092 has to be exactly what is in the configuration
bin/kafka-console-consumer.sh --bootstrap-server localhost:9092 --topic &lt;name&gt;

other parameters:::

    * --from-beginning if want to receive starting from the earliest present in the log
    * --property print.key=true if want to see the keys
    * --property key.separator=&quot;&lt;separator&gt;&quot; to set the separator, default \t 
</code></pre><p>WARNING: Receiving messages encoded in UTF-8 might show incorrect values (at least on Windows)</p>
<p>=== Recover after kafka-server-stop on Windows</p>
<p>After stopping with this command, when trying to start again it complains some file.timeindex (from a topic) is used by another program:</p>
<pre><code>* stopping zookeeper and starting again doesn&apos;t help
* seems related to https://issues.apache.org/jira/browse/KAFKA-6044
* To fix just delete the kafka-logs data folder&#x2026;
</code></pre><p>=== Start multiple nodes in a cluster</p>
<h2 id="use-different-configuration-files-configserverproperties-with-different-id-and-different-listener-port">Use different configuration files (config/server.properties) with different id and different listener port:</h2>
<pre><code>broker.id = 1
listeners=PLAINTEXT://:9093
log.dir=/another/dir/for/this/one
</code></pre><hr>
<p>Now when creating a topic we could add a replication factor bigger than one</p>
<p>== Usage notes</p>
<p>Consumer should poll() at least once every session.timeout.ms or it will get CommitFailedException, this is also usefull if the binary fails to work or hangs somewhere.</p>
<p>== systemd example service files</p>
<p>.kafka.service</p>
<h2 id="sourceini">[source,ini]</h2>
<p>[Unit]
Description=Kafka service
After=network.target
Wants=kafka-zookeeper.service</p>
<p>[Service]
ExecStart=/path/to/kafka/bin/kafka-server-start.sh /path/to/kafka/config/server.properties
SuccessExitStatus=143
StandardOutput=null</p>
<p>[Install]</p>
<h2 id="wantedbymulti-usertarget">WantedBy=multi-user.target</h2>
<p>.kafka-zookeeper.service</p>
<h2 id="sourceini">[source,ini]</h2>
<p>[Unit]
Description=Kafka Zookeeper service
After=network.target</p>
<p>[Service]
ExecStart=/path/to/kafka/bin/zookeeper-server-start.sh /path/to/kafka/config/zookeeper.properties
SuccessExitStatus=143
StandardOutput=null</p>
<p>[Install]</p>
<h2 id="wantedbymulti-usertarget">WantedBy=multi-user.target</h2>

                                
                                </section>
                            
    </div>
    <div class="search-results">
        <div class="has-results">
            
            <h1 class="search-results-title"><span class='search-results-count'></span> results matching "<span class='search-query'></span>"</h1>
            <ul class="search-results-list"></ul>
            
        </div>
        <div class="no-results">
            
            <h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1>
            
        </div>
    </div>
</div>

                        </div>
                    </div>
                
            </div>

            
                
                <a href="cloud.html" class="navigation navigation-prev " aria-label="Previous page: Cloud and distributed">
                    <i class="fa fa-angle-left"></i>
                </a>
                
                
                <a href="zookeeper.html" class="navigation navigation-next " aria-label="Next page: zookeeper">
                    <i class="fa fa-angle-right"></i>
                </a>
                
            
        
    </div>

    <script>
        var gitbook = gitbook || [];
        gitbook.push(function() {
            gitbook.page.hasChanged({"page":{"title":"kafka","level":"1.7.1","depth":2,"next":{"title":"zookeeper","level":"1.7.2","depth":2,"path":"cloud/zookeeper.md","ref":"cloud/zookeeper.md","articles":[]},"previous":{"title":"Cloud and distributed","level":"1.7","depth":1,"path":"cloud/cloud.md","ref":"cloud/cloud.md","articles":[{"title":"kafka","level":"1.7.1","depth":2,"path":"cloud/kafka.md","ref":"cloud/kafka.md","articles":[]},{"title":"zookeeper","level":"1.7.2","depth":2,"path":"cloud/zookeeper.md","ref":"cloud/zookeeper.md","articles":[]}]},"dir":"ltr"},"config":{"gitbook":"*","theme":"default","variables":{},"plugins":["asciidoc-admonition-icons"],"pluginsConfig":{"asciidoc-admonition-icons":{},"highlight":{},"search":{},"lunr":{"maxIndexSize":1000000,"ignoreSpecialCharacters":false},"sharing":{"facebook":true,"twitter":true,"google":false,"weibo":false,"instapaper":false,"vk":false,"all":["facebook","google","twitter","weibo","instapaper"]},"fontsettings":{"theme":"white","family":"sans","size":2},"theme-default":{"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"showLevel":false}},"structure":{"langs":"LANGS.md","readme":"README.md","glossary":"GLOSSARY.md","summary":"SUMMARY.md"},"pdf":{"pageNumbers":true,"fontSize":12,"fontFamily":"Arial","paperSize":"a4","chapterMark":"pagebreak","pageBreaksBefore":"/","margin":{"right":62,"left":62,"top":56,"bottom":56}},"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"}},"file":{"path":"cloud/kafka.md","mtime":"2018-03-05T06:29:23.092Z","type":"markdown"},"gitbook":{"version":"3.2.3","time":"2018-03-05T14:29:57.750Z"},"basePath":"..","book":{"language":""}});
        });
    </script>
</div>

        
    <script src="../gitbook/gitbook.js"></script>
    <script src="../gitbook/theme.js"></script>
    
        
        <script src="../gitbook/gitbook-plugin-search/search-engine.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-search/search.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-lunr/lunr.min.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-lunr/search-lunr.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-sharing/buttons.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-fontsettings/fontsettings.js"></script>
        
    

    </body>
</html>

