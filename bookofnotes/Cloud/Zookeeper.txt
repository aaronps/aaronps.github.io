Content-Type: text/x-zim-wiki
Wiki-Format: zim 0.4

====== Zookeeper ======

https://zookeeper.apache.org/

ZooKeeper is a centralized service for maintaining configuration information, naming, providing distributed synchronization, and providing group services. All of these kinds of services are used in some form or another by distributed applications.

From <https://cwiki.apache.org/confluence/display/ZOOKEEPER/Index> 

* In Zookeeper, only the leader makes changes to data and distributes it.
* Zookeeper is used by some other software to coordinate, for example, Kafka.
* ZooKeeper has JMX working, so you can use java mission control to connect to it and do things

===== Starting =====

There should be one configuration file which is shared with all the nodes… so all the nodes on the cluster uses the same configuration file. Once the cluster is started, if it is version 3.5.0+ then its possible to dynamically update the config (that is, the list of servers which makes the cluster).

The configuration file have:

{{{code:
tickTime=2000
dataDir=/var/lib/zookeeper
clientPort=2181
}}}

Then start it pointing to the config file if needed.

Connect to it and access a shell-like environment, folders and files within folders, these represent the data, when some data is written to these, it is replicated to the servers.

===== Replicated =====

When running replicated, the config file may have extra lines:

{{{code:
initLimit=5
syncLimit=2
server.1=server-1-address:2888:3888
server.2=server-2-address:2888:3888
server.3=server-3-address:2888:3888
}}}

Each servers knows who is it because there should be a $dataDir/myid file which has an integer telling it which server it is. Note that if running multiple instances on the same server you have to use copies of the config file with different path for the dataDir, and maybe different ports.

If version is >= 3.5.0 the config file has slight changes

{{{code:
tickTime=2000
dataDir=/var/lib/zookeeper
initLimit=5
syncLimit=2
server.1=server-1-address:2888:3888;2181
server.2=server-2-address:2888:3888;2181
server.3=server-3-address:2888:3888;2181
}}}

The first port is the normal communication port for communicating from server to server(2888 in this case)
The second port is the leader selection port, will be used when the leader is lost(3888)
The port after the semicolon (if it exists) is the client port… which is the one the client applications uses to connect.

===== Optimizations on config =====

To get low latencies on updates it is important to have a dedicated transaction log directory. By default transaction logs are put in the same directory as the data snapshots and myid file. The dataLogDir parameters indicates a different directory to use for the transaction logs.
	
From <https://zookeeper.apache.org/doc/trunk/zookeeperStarted.html> 



